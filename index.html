<!DOCTYPE html>
<html>
  <head>
    <meta charset='utf-8'>
    <meta http-equiv="X-UA-Compatible" content="chrome=1">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <link href='https://fonts.googleapis.com/css?family=Architects+Daughter' rel='stylesheet' type='text/css'>
    <link rel="stylesheet" type="text/css" href="stylesheets/stylesheet.css" media="screen">
    <link rel="stylesheet" type="text/css" href="stylesheets/github-light.css" media="screen">
    <link rel="stylesheet" type="text/css" href="stylesheets/print.css" media="print">

    <!--[if lt IE 9]>
    <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->

    <title>Citybash by FluxLemur</title>
  </head>

  <body>
    <header>
      <div class="inner">
        <h1>Citybash</h1>
        <h2>A simple real-time strategy game with a sever-side engine.</h2>
        <a href="https://github.com/FluxLemur/citybash" class="button"><small>View project on</small> GitHub</a>
      </div>
    </header>

    <div id="content-wrapper">
      <div class="inner clearfix">
        <section id="main-content">
          <h1>
<a id="citybash" class="anchor" href="#citybash" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>CityBash</h1>

<p>CityBash is simple <a href="https://en.wikipedia.org/wiki/Real-time_strategy">real time strategy
game</a> implemented as a
stand-alone server to facilitate integration of AI players.</p>

<ol>
<li><a href="#overview">Overview</a></li>
<li><a href="#gameplay">Gameplay</a></li>
<li><a href="#game-mechanics">Game Mechanics</a></li>
<li><a href="#server-interface">Server Interface</a></li>
<li><a href="#running-the-game-client">Running the Game Client</a></li>
<li><a href="#running-the-server">Running the Server</a></li>
<li><a href="#implementation">Implementation</a></li>
</ol>

<h2>
<a id="overview" class="anchor" href="#overview" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Overview</h2>

<p>CityBash has no front end. The player sends commands to a game server running
on a certain host and port, and is in control of <em>one</em> city with some assets
and capabilities.</p>

<ul>
<li>Assets

<ul>
<li>Gold</li>
<li>Army</li>
</ul>
</li>
<li>Capabilities

<ul>
<li>Upgrade city</li>
<li>Increase army size</li>
<li>Attack other cities</li>
</ul>
</li>
</ul>

<h2>
<a id="gameplay" class="anchor" href="#gameplay" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Gameplay</h2>

<ul>
<li>Gold Usage

<ul>
<li>Each city has a base income of gold at the start of the game.</li>
<li>A player can spend gold to:

<ul>
<li>Increase city level</li>
<li>Train soldiers</li>
</ul>
</li>
</ul>
</li>
<li>City Level

<ul>
<li>The player's city starts at level 1.</li>
<li>Higher level cities yield higher gold income, and have a larger defense multiplier.</li>
<li>Level 5 is the highest.</li>
</ul>
</li>
<li>Military

<ul>
<li>The city houses a player's army.</li>
<li>Consider a scenario below in which City A start with 20 soldiers.</li>
<li>An attack happens in 3 steps. Let’s say city A orders 10 soldiers to attack city B (the other 10 will remain defending the city).

<ol>
<li>Nothing happens for 5 seconds. The army is moving from A to B.</li>
<li>The 10 soliders of A's army attack the soliders that are currently in B's city. Both sides sustain losses. If the attackers succeed, they take some gold with them (at most 3 gold for each soldier). Some of B's gold is safely hidden in it's <em>cache</em> (gold is automatically stored in a city's cache).</li>
<li>After 5 more seconds, the remaining soliders of the original 10 return to city A. If they are carrying gold from a successful attack, the gold is added to A’s hold.</li>
</ol>
</li>
<li>Run <code>simulations/battle_sim.py</code> for some examples.</li>
</ul>
</li>
<li>Ending Conditions

<ul>
<li>The game stops when either:

<ol>
<li>A player upgrades to a level 5 city</li>
<li>The admin terminates after some amount of time (say, 10 minutes)</li>
</ol>
</li>
</ul>
</li>
</ul>

<h2>
<a id="game-mechanics" class="anchor" href="#game-mechanics" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Game Mechanics</h2>

<ul>
<li>Armies

<ul>
<li>Training a soldier costs 5 gold and takes 5 seconds. Soldiers are trained asynchronously.</li>
<li>Soldiers can carry at most 3 gold each</li>
</ul>
</li>
</ul>

<table>
<thead>
<tr>
<th>City Level</th>
<th>Income (gold/s)</th>
<th>Defense Multiplier</th>
<th>Upgrade Cost (gold, time)</th>
<th>Cache size (gold)</th>
</tr>
</thead>
<tbody>
<tr>
<td>1</td>
<td>1</td>
<td>1.1</td>
<td>30, 20</td>
<td>5</td>
</tr>
<tr>
<td>2</td>
<td>2</td>
<td>1.15</td>
<td>90, 30</td>
<td>15</td>
</tr>
<tr>
<td>3</td>
<td>3</td>
<td>1.2</td>
<td>270, 40</td>
<td>45</td>
</tr>
<tr>
<td>4</td>
<td>5</td>
<td>1.25</td>
<td>810, 50</td>
<td>135</td>
</tr>
</tbody>
</table>

<ul>
<li>Note that as soon as a city becomes level 5, the game is over.</li>
</ul>

<h2>
<a id="server-interface" class="anchor" href="#server-interface" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Server Interface</h2>

<p>The game runs as a server. The administrator first gives each player a unique
key which the player uses to join the game with the following command:</p>

<ul>
<li>
<code>[player key] join [city_name]</code> (note that <code>city_name</code> cannot have spaces)</li>
</ul>

<p>Once the game begins, players can send a selection of commands to list
information about their city and the world, as well as commands to upgrade
their city, train soldiers, and make attacks.</p>

<p>The valid player commands are (<em>not</em> case sensitive):</p>

<ul>
<li>
<code>WORLD</code> or <code>W</code>
</li>
<li>
<code>CITY</code> or <code>C</code>
</li>
<li>
<code>SHORTCITY</code> or <code>SC</code>
</li>
<li>
<code>COSTS</code> or <code>CO</code>
</li>
<li>
<code>UPGRADE</code> or <code>U</code>
</li>
<li>
<code>TRAIN #</code> or <code>T #</code>

<ul>
<li>
<code>TRAIN max</code> uses all current gold to train soldiers</li>
</ul>
</li>
<li>
<code>ATTACK city #</code> or <code>A city #</code>

<ul>
<li>
<code>city</code> can be either a city name or a city id</li>
</ul>
</li>
</ul>

<p>The server response is given below each respective player message.</p>

<ul>
<li>
<code>[player key] WORLD</code>

<ul>
<li><code>WORLD</code></li>
<li><code>[city name] ([city id]) [city level]</code></li>
<li>... (newline delimited)</li>
</ul>
</li>
<li>
<code>[player key] CITY</code>

<ul>
<li><code>CITY [city name]</code></li>
<li><code>LEVEL [current city level]</code></li>
<li><code>GOLD [current gold amount]</code></li>
<li><code>INCOME [current gold income]</code></li>
<li><code>ARMY [# of soldiers in city]</code></li>
<li>
<code>[list of notifcations]</code> with each item of the form <code>* [#] sec ago: [contents]</code>. The <code>[contents]</code> can be one of two options:

<ul>
<li>
<code>[city name] attacked [#]/[#] took [#] gold, [#]/[#] defenders remained</code> These are for attacks on your city</li>
<li>
<code>attacked [city name] [#]/[#] took [#] gold{, [#]/[#] defenders remained}</code> These are for attacks by your city on other cities. If you have at least 1 soldier remaining, the part of the message enclosed in <code>{}</code> is included</li>
</ul>
</li>
</ul>
</li>
<li>
<code>[player key] SHORTCITY</code>

<ul>
<li><code>SHORTCITY [name] LEVEL [#], GOLD [#], INCOME [#], ARMY [#]</code></li>
</ul>
</li>
<li>
<code>[player key] COSTS</code>

<ul>
<li><code>COSTS</code></li>
<li><code>UPGRADE [gold to upgrade city] gold, [time to upgrade city] sec</code></li>
<li><code>TRAIN [gold to train soldier] gold, [time to train soldier] sec</code></li>
</ul>
</li>
<li>
<code>[player key] UPGRADE</code>

<ul>
<li>
<code>UPGRADE SUCCESS</code> if current gold &gt;= upgrade cost</li>
<li>
<code>UPGRADE FAILURE [gold needed] &gt; [current gold]</code> otherwise</li>
</ul>
</li>
<li>
<code>[player key] TRAIN [# soldiers]</code>

<ul>
<li>
<code>TRAIN [# soldiers] SUCCESS</code> if current gold &gt;= cost of soldiers</li>
<li>
<code>INVALID TRAIN. VALID: [player key] TRAIN [# soldiers]</code> if wrong format or # soldiers is
not a positive integer</li>
<li>
<code>TRAIN FAILURE Cannot train 0 soldiers</code> corner case</li>
<li>
<code>TRAIN FAILURE [# soldiers] COSTS [gold needed] &gt; [current gold]</code> otherwise</li>
</ul>
</li>
<li>
<code>[player key] ATTACK [city-name] [# soldiers]</code>

<ul>
<li>
<code>INVALID ATTACK. VALID: [player key] ATTACK [other city name] [# soldiers]</code>
if syntax is invalid (not 4 tokens or # soldiers is not a positive integer)</li>
<li>
<code>ATTACK FAILURE Cannot attack with 0 soldiers</code>, or</li>
<li>
<code>ATTACK FAILURE Cannot attack your own city</code>, or</li>
<li>
<code>ATTACK FAILURE No city [city-name]</code>, or</li>
<li>
<code>ATTACK FAILURE [# soldiers] &gt; [# soldiers in city]</code>, or</li>
<li><code>ATTACK SENT TO [city-name] [# soldiers]</code></li>
</ul>
</li>
</ul>

<p>After the round-trip time for the attack, a notification will appear in your
<code>CITY</code> response (as above). If you have many new notifications, they will all
be displayed. However, if there are no new notifications, only the 3 most recent
notifications will be displayed.</p>

<p>When the game is over, the server rejects player commands, and the
administrator can announce the results.</p>

<h2>
<a id="running-the-game-client" class="anchor" href="#running-the-game-client" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Running the Game Client</h2>

<p>The shell script <code>run_client.sh</code> provides a simple game client that a player
can use to connect to the game server.</p>

<p>NOTE: the script has a dependency on
<a href="https://github.com/hanslub42/rlwrap"><code>rlwrap</code></a>, a readline wrapper for user
input. It can easily be installed with <code>apt-get</code> or <code>brew</code>. If you prefer not to
use it, edit <code>run_client.sh</code> and remove it.</p>

<h2>
<a id="running-the-server" class="anchor" href="#running-the-server" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Running the Server</h2>

<p>In order to build and run the server locally, you must first ensure you have the
dependencies:</p>

<ul>
<li><a href="http://clang.llvm.org/">clang++</a></li>
<li><a href="http://libevent.org/">libevent2</a></li>
</ul>

<p>The following steps will get a server up and running:</p>

<ol>
<li>
<code>make</code> creates the <code>citybash</code> binary - this is the server.</li>
<li>
<code>./citybash 123</code> starts the server with an admin key of <code>123</code> (you can use whatever you like)</li>
<li>
<code>cd clients/ &amp;&amp; ./admin_client.sh</code> This will connect you to a the citybash server (which should running on localhost at port 12345). Send admin commands by prepending the admin key <code>123</code>.</li>
<li>See <code>src/game_state.h</code> for valid admin commands (or send some random string
and the server will respond with the valid commands).</li>
</ol>

<h2>
<a id="implementation" class="anchor" href="#implementation" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Implementation</h2>

<p>The engine is implemented in C++. I attempt to follow the
<a href="https://google.github.io/styleguide/cppguide.html">Google C++ Style Guide</a>.</p>

<p>Simulations of the game mechanics are in Python (see <code>simulations/</code>). A guiding
philosophy is that decisions should be "data-informed" rather than arbitrary.</p>
        </section>

        <aside id="sidebar">
          <a href="https://github.com/FluxLemur/citybash/zipball/master" class="button">
            <small>Download</small>
            .zip file
          </a>
          <a href="https://github.com/FluxLemur/citybash/tarball/master" class="button">
            <small>Download</small>
            .tar.gz file
          </a>

          <p class="repo-owner"><a href="https://github.com/FluxLemur/citybash"></a> is maintained by <a href="https://github.com/FluxLemur">FluxLemur</a>.</p>

          <p>This page was generated by <a href="https://pages.github.com">GitHub Pages</a> using the Architect theme by <a href="https://twitter.com/jasonlong">Jason Long</a>.</p>
        </aside>
      </div>
    </div>

  
  </body>
</html>
